import{c as x,$ as l,f as h,u as n,m as g,I as T,a as W,B as L,D as z,_ as I,b as f,d as r,w as m,p as b,r as c,o as p,h as k,i as B,t as D,F as N,k as P,e as O,q as A,j as S,n as F,g as J}from"./index-eba71058.js";import C from"./Chart-d04bcb05.js";import V from"./List-0646a804.js";import R from"./Aside-c2f94b25.js";import G from"./Slider-e51ee24d.js";import M from"./Switch-2a98c72b.js";const U={data(){return{id_:"",out:"",batch:1,data:"",task:"",width:1,data_:[],error:"",tasks:[],height:1,title:"",config:"",device:"",margin:16,params:[],timers:[],titles:[],configs:[],devices:[],padding:16,results:{},color:x,sessions:[],asideWidth:0,asideWidth_:0,interval:null}},mounted(){this.load(),this.asideWidth_=l(window).width()<1480?280:320,h(`${n}/tasks`,{}).then(t=>{this.tasks=t.tasks}).catch(t=>this.error=t),h(`${n}/devices`,{}).then(t=>{this.devices=t.devices}).catch(t=>this.error=t)},updated(){this.width=l(window).width()-(this.asideWidth||this.asideWidth_)-this.margin*2-this.padding*2,this.height=l(window).height()-l(".nav").height()-this.margin*2-this.padding*2},props:{pipeline_:{}},computed:{items(){return this.sessions.map(t=>({text:t.id_,status:t.status}))}},watch:{task(){h(`${n}/configs`,{task:this.task}).then(t=>{this.configs=t.configs,this.config=this.configs[0]}).catch(t=>this.error=t),this.save()},title(){this.setChart()},config(){let t={id_:this.id_,action:"param",task:this.task,cfg_id:this.config,pipeline:this.pipeline_.toLowerCase()};h(`${n}/main`,t).then(i=>{this.params=i.params.map(s=>({min:s.min_,max:s.max_,value:s.value,name:s.name.replace("_"," "),type:s.type.replace("bool","switch").replace("range","slider")}))}).catch(i=>this.error=i),this.save()},results(){this.setChart()}},methods:{load(){h(`${n}/main`,{file:"ai.json"}).then(t=>{this.id_=t.id_||"",this.task=t.task||"",this.out=t.out_dir||"",this.epoch=t.epochs||"",this.data=t.data_dir||"",this.config=t.cfg_id||"",this.device=t.device||"",this.batch=t.batch_size||"",this.sessions=JSON.parse(t.sessions)||[],this.setTimer(this.id_)}).catch(t=>this.error=t)},save(t,i){i&&t&&(this[i.split(" ")[0].toLowerCase()]=t);let s={file:"ai.json",id_:this.id_||"",task:this.task||"",out_dir:this.out||"",epochs:this.epoch||"",data_dir:this.data||"",cfg_id:this.config||"",device:this.device||"",batch_size:this.batch||"",pipeline:this.pipeline_.toLowerCase()||"",sessions:JSON.stringify(this.sessions||[])};for(const a of this.params)s[a.name]=a.value;h(`${n}/main`,s).catch(a=>this.error=a)},fetch(){if(this.id_==""||this.out==""||this.config==""||this.data=="")return;let t={id_:this.id_,action:"result",out_dir:this.out,cfg_id:this.config,data_dir:this.data};h(`${n}/main`,t).then(i=>{this.results=i.results,this.titles=Object.keys(this.results||{}),this.titles.length&&(this.results[this.titles[0]].length.toString()==this.epoch?(this.sessions.find(s=>s.id_==this.id_).status="Stopped",this.clearTimer(this.id_)):this.sessions.find(s=>s.id_==this.id_).status="Running")}).catch(i=>this.error=i)},slide(t,i){let s=this.params.findIndex(a=>a.name==i);this.params[s].value=parseFloat(t)},run(t){this.id_="",this.title="";let i={id_:`session${this.sessions.length?parseInt(this.sessions.at(-1).id_.replace("session",""))+1:0}`,status:"Starting",task:this.task,out_dir:this.out,epochs:this.epoch,cfg_id:this.config,data_dir:this.data,batch_size:this.batch,action:this.pipeline_.toLowerCase(),device:this.device.replace(/GPU:/g,"")};for(const s of this.params)i[s.name]=s.value;return h(`${n}/main`,i).catch(s=>this.error=s),this.sessions.push(i),this.id_=i.id_,this.save(),this.setTimer(this.id_),t},swtich_(t,i){let s=this.params.findIndex(a=>a.name==i);this.params[s].value=!!t,this.save()},setChart(){if(!this.title)return;this.data_=this.results[this.title],this.data_.unshift(0);let t=10,i=(Math.ceil(this.data_.length/t)+(this.data_.length<this.epoch,0))*t;this.xLabels=this.data_.length?g(i,t):g(t+1)},setTimer(t){let i=this.timers.findIndex(s=>s.id==t);i>-1?this.timers[i].interval=setInterval(()=>this.fetch(),1e3):this.timers.push({id:t,interval:setInterval(()=>this.fetch(),1e3)})},clearTimer(t){this.timers.findIndex(s=>s.id==t)>-1&&clearInterval(this.timers[t].interval),this.timers=this.timers.filter(s=>s.id==t)},clickItem(t){let i=this.sessions.find(s=>s.id_==t);this.id_=t,this.task=i.task,this.out=i.out_dir,this.epoch=i.epochs,this.data=i.data_dir,this.config=i.cfg_id,this.device=i.device,this.batch=i.batch_size},removeItem(t){let i={id_:t,action:"remove",out_dir:this.out,cfg_id:this.config,data_dir:this.data};this.sessions=this.sessions.filter(s=>s.id_!=t),this.clearTimer(this.id_),this.id_="",this.save(),h(`${n}/main`,i).catch(s=>this.error=s)},toggleItem(t){let i={id_:t,action:"toggle",out_dir:this.out,cfg_id:this.config,data_dir:this.data};h(`${n}/main`,i).catch(s=>this.error=s)}},components:{Icon:T,List:V,Aside:R,Chart:C,Input:W,Button:L,Slider:G,Switch:M,Dropdown:z}};const q=S("section",null,null,-1);function E(t,i,s,a,e,d){const u=c("Input"),o=c("dropdown"),v=c("Button"),w=c("list"),y=c("Aside");return p(),f("section",null,[r(y,{margin:0,width:e.asideWidth_,onSetWidth:i[0]||(i[0]=_=>e.asideWidth=_)},{default:m(()=>[r(o,{class:k("accordion"),accordion:"Basic"},{default:m(()=>[r(u,{label:"Data Path",value:e.data,onInput:d.save,icon:"folder",height:24,box:32,right:!0},null,8,["value","onInput"]),r(u,{label:"Out Path",value:e.out,onInput:d.save,icon:"folder",height:24,box:32,right:!0},null,8,["value","onInput"]),r(o,{label:"Task",value:e.task,onSelect:d.save,items:e.tasks},null,8,["value","onSelect","items"]),r(o,{label:"Config",value:e.config,onSelect:d.save,items:e.configs},null,8,["value","onSelect","items"]),r(o,{label:"Device",value:e.device,onSelect:d.save,items:e.devices},null,8,["value","onSelect","items"]),r(u,{label:"Batch",value:e.batch,onInput:d.save},null,8,["value","onInput"]),b(t.$slots,"basic")]),_:3}),r(o,{class:k("accordion"),accordion:"Sessions"},{default:m(()=>[r(v,{onClick:d.run},{default:m(()=>[B(D(s.pipeline_),1)]),_:1},8,["onClick"]),r(w,{items:d.items,onRemoveItem:d.removeItem,onToggleItem:d.toggleItem,onClickItem:d.clickItem},null,8,["items","onRemoveItem","onToggleItem","onClickItem"])]),_:1}),r(o,{class:k("accordion"),accordion:"Advanced"},{default:m(()=>[q,(p(!0),f(N,null,P(e.params,_=>(p(),O(A(_.type),{class:"param",float:"right",padding:8,label_:_.name,range:"80%",min:_.min,max:_.max,onSlide:d.slide,_on:_.name,onSwitch:d.swtich_},null,40,["label_","min","max","onSlide","_on","onSwitch"]))),256))]),_:1})]),_:3},8,["width"]),b(t.$slots,"content")])}const H=I(U,[["render",E]]),K={data(){return{id_:"",out:"",batch:1,data:"",epoch:1,task:"",width:1,data_:[],error:"",height:1,title:"",config:"",device:"",margin:16,params:[],timers:[],titles:[],configs:[],devices:[],padding:16,results:{},xLabels:[],color:x,sessions:[],asideWidth:0,asideWidth_:0,interval:null}},mounted(){this.load(),this.asideWidth_=l(window).width()<1480?280:320,h(`${n}/devices`,{}).then(t=>{this.devices=t.devices}).catch(t=>this.error=t)},updated(){this.width=l(window).width()-(this.asideWidth||this.asideWidth_)-this.margin*2-this.padding*2,this.height=l(window).height()-l(".nav").height()-this.margin*2-this.padding*2},computed:{items(){return this.sessions.map(t=>({text:t.id_,status:t.status}))}},watch:{task(){h(`${n}/configs`,{task:this.task}).then(t=>{this.configs=t.configs,this.config=this.configs[0]}).catch(t=>this.error=t),this.save()},title(){this.setChart()},config(){let t={id_:this.id_,action:"param",task:this.task,process:"train",cfg_id:this.config};h(`${n}/main`,t).then(i=>{this.params=i.params.map(s=>({min:s.min_,max:s.max_,value:s.value,name:s.name.replace("_"," "),type:s.type.replace("bool","switch").replace("range","slider")}))}).catch(i=>this.error=i),this.save()},results(){this.setChart()}},methods:{load(){h(`${n}/main`,{file:"ai.json"}).then(t=>{this.id_=t.id_||"",this.task=t.task||"",this.out=t.out_dir||"",this.epoch=t.epochs||"",this.data=t.data_dir||"",this.config=t.cfg_id||"",this.device=t.device||"",this.batch=t.batch_size||"",this.sessions=JSON.parse(t.sessions)||[],this.setTimer(this.id_)}).catch(t=>this.error=t)},save(t,i){i&&t&&(this[i.split(" ")[0].toLowerCase()]=t);let s={file:"ai.json",action:"train",id_:this.id_||"",task:this.task||"",out_dir:this.out||"",epochs:this.epoch||"",data_dir:this.data||"",cfg_id:this.config||"",device:this.device||"",batch_size:this.batch||"",sessions:JSON.stringify(this.sessions||[])};for(const a of this.params)s[a.name]=a.value;h(`${n}/main`,s).catch(a=>this.error=a)},fetch(){if(this.id_==""||this.out==""||this.config==""||this.data=="")return;let t={id_:this.id_,action:"result",out_dir:this.out,cfg_id:this.config,data_dir:this.data};h(`${n}/main`,t).then(i=>{this.results=i.results,this.titles=Object.keys(this.results||{}),this.titles.length&&(this.results[this.titles[0]].length.toString()==this.epoch?(this.sessions.find(s=>s.id_==this.id_).status="Stopped",this.clearTimer(this.id_)):this.sessions.find(s=>s.id_==this.id_).status="Training")}).catch(i=>this.error=i)},slide(t,i){let s=this.params.findIndex(a=>a.name==i);this.params[s].value=parseFloat(t)},train(t){this.id_="",this.title="";let i={id_:`session${this.sessions.length?parseInt(this.sessions.at(-1).id_.replace("session",""))+1:0}`,action:"train",status:"Starting",task:this.task,out_dir:this.out,epochs:this.epoch,cfg_id:this.config,data_dir:this.data,batch_size:this.batch,device:this.device.replace(/GPU:/g,"")};for(const s of this.params)i[s.name]=s.value;return h(`${n}/main`,i).catch(s=>this.error=s),this.sessions.push(i),this.id_=i.id_,this.save(),this.setTimer(this.id_),t},swtich_(t,i){let s=this.params.findIndex(a=>a.name==i);this.params[s].value=!!t,this.save()},setChart(){if(!this.title)return;this.data_=this.results[this.title],this.data_.unshift(0);let t=10,i=(Math.ceil(this.data_.length/t)+(this.data_.length<this.epoch,0))*t;this.xLabels=this.data_.length?g(i,t):g(t+1)},setTimer(t){let i=this.timers.findIndex(s=>s.id==t);i>-1?this.timers[i].interval=setInterval(()=>this.fetch(),1e3):this.timers.push({id:t,interval:setInterval(()=>this.fetch(),1e3)})},clearTimer(t){this.timers.findIndex(s=>s.id==t)>-1&&clearInterval(this.timers[t].interval),this.timers=this.timers.filter(s=>s.id==t)},clickItem(t){let i=this.sessions.find(s=>s.id_==t);this.id_=t,this.task=i.task,this.out=i.out_dir,this.epoch=i.epochs,this.data=i.data_dir,this.config=i.cfg_id,this.device=i.device,this.batch=i.batch_size},removeItem(t){let i={id_:t,action:"remove",out_dir:this.out,cfg_id:this.config,data_dir:this.data};this.sessions=this.sessions.filter(s=>s.id_!=t),this.clearTimer(this.id_),this.id_="",this.save(),h(`${n}/main`,i).catch(s=>this.error=s)},toggleItem(t){let i={id_:t,action:"toggle",out_dir:this.out,cfg_id:this.config,data_dir:this.data};h(`${n}/main`,i).catch(s=>this.error=s)}},components:{Chart:C,Pipeline:H}};const Q={class:"train"},X={class:"toolbar",style:{width:"30%"}};function Y(t,i,s,a,e,d){const u=c("Pipeline"),o=c("dropdown"),v=c("chart");return p(),f("section",Q,[r(u,{pipeline_:"Train"}),e.data_.length?(p(),f("section",{key:0,class:"charts",style:F({marginLeft:`${e.asideWidth||e.asideWidth_}px`})},[r(v,{data:e.data_,width:e.width,height:e.height-32,margin:e.margin,padding:e.padding,"x-labels":e.xLabels},{default:m(()=>[S("section",X,[r(o,{onSelect:i[0]||(i[0]=w=>e.title=w),items:e.titles,selected:e.title,width:"100%"},null,8,["items","selected"])])]),_:1},8,["data","width","height","margin","padding","x-labels"])],4)):J("",!0)])}const et=I(K,[["render",Y]]);export{et as default};
