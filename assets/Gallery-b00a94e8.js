import{c as x,$ as f,f as c,u as l,a as v,B as I,_ as y,b,j as s,t as g,d,w as j,n as r,e as H,g as W,r as m,o as _,i as k}from"./index-eba71058.js";import C from"./Drawing-ed2596b5.js";import"./Circle-6796e60d.js";const O={data(){return{src:"",error:"",top:0,top_:0,left:0,right:0,index:0,margin:0,width_:0,height_:0,imgWidth:0,imgHeight:0,color:x,drawing_:!1,padding:`${screen.width<800?8:16}px 0`}},mounted(){this.fetchImage(0),this.top=this.height/2,this.right=this.width-this.width_-(screen.width<1480?88:80)},updated(){this.width_>0&&(this.right=(this.width-this.width_-64)/2-(screen.width<1480?20:16),this.left=(this.width-this.width_-64)/2-(screen.width<1480?4:0),this.top=this.height/2,this.setImage())},methods:{next(i){return this.fetchImage(this.index<this.paths.length-1?this.index+1:this.index),this.drawing_=!1,i},prev(i){return this.fetchImage(this.index>0?this.index-1:0),this.drawing_=!1,i},setImage(){this.imgWidth>this.imgHeight?(this.width_=this.imgWidth>this.width-128?this.width-128:this.imgWidth,this.height_=this.width_/this.imgWidth*this.imgHeight):this.imgWidth<this.imgHeight?(this.height_=this.imgHeight>this.height-64?this.height-64:this.imgHeight,this.width_=this.height_/this.imgHeight*this.imgWidth):(this.height_=this.imgHeight>this.height-64?this.height-64:this.imgHeight,this.width_=this.imgWidth>this.width-128?this.width-128:this.imgWidth),this.margin=(this.height-this.height_)/2,this.top_=this.margin-(screen.height>800?32:40)},setIndex(i){let h=f(i.target).prev().prev().text(),t=parseInt(h)-1;return t=t>=this.paths.length-1?this.paths.length-1:t,t=t<=-1?0:t,this.fetchImage(t),this.drawing_=!1,i},hoverItem(i){this.$emit("hoverItem",i)},removeItem(i){this.$emit("removeItem",i)},fetchImage(i){c(`${l}/imread`,{path:this.paths[i]}).then(h=>{this.src=h.base64;let t=new Image;t.src=this.src,this.x1=0,this.y1=0,this.x2=0,this.y2=0,t.onload=()=>{this.index=i,this.drawing_=!0,this.imgWidth=t.width,this.imgHeight=t.height,this.$emit("setObjects",h.labels),this.setImage()}}).catch(h=>this.error=h)},setObjects(i,h){let t=this.objects,o=t.findIndex(e=>e.id_==i.id_);o==-1?t.push(i):t[o]=i,this.$emit("setObjects",t),h&&c(`${l}/imwrite`,{path:this.paths[this.index],labels:JSON.stringify(t)}).catch(e=>this.error=e)}},props:{paths:{type:Array},width:{type:Number},height:{type:Number},shape:{type:String},sep:{type:String},selected:{type:String},objects:{}},watch:{objects:{handler(){c(`${l}/imwrite`,{path:this.paths[this.index],labels:JSON.stringify(this.objects)}).catch(i=>this.error=i)},deep:!0}},emits:["setObjects","hoverItem","removeItem"],components:{Input:v,Button:I,Drawing:C}};const S={class:"gallery"},B={class:"info"},N={class:"path"},T={class:"resolution"},V={class:"page"},G={class:"total"},A={class:"viewer"},D=["src"];function E(i,h,t,o,e,n){const p=m("Input"),w=m("Button"),u=m("drawing");return _(),b("section",S,[s("section",B,[s("span",N,g(t.paths[e.index].split(t.sep).at(-1)),1),s("span",T,g(` ${e.imgWidth} ${e.imgHeight}`),1),s("span",V,[d(p,{value:e.index+1,type:"number",min:1,max:t.paths.length,width:"100"},null,8,["value","max"]),s("span",G,g("/"+t.paths.length),1),d(w,{onClick:n.setIndex},{default:j(()=>[k("Go")]),_:1},8,["onClick"])])]),s("section",A,[s("section",{class:"navigator",style:r({marginTop:`${e.top-48}px`})},[s("span",{class:"prev",style:r({backgroundColor:e.color}),onClick:h[0]||(h[0]=(...a)=>n.prev&&n.prev(...a))},g("❮"),4)],4),s("section",{class:"img",style:r({marginTop:`${e.top_}px`,marginLeft:`${e.left}px`})},[s("img",{src:e.src,style:r({width:`${e.width_}px`,height:`${e.height_}px`})},null,12,D),e.drawing_?(_(),H(u,{key:0,width:t.width,height:t.height,width_:e.width_,height_:e.height_,shape:t.shape,left:e.left,margin:e.margin,selected:t.selected,objects:t.objects,onSetObjects:n.setObjects,onHoverItem:n.hoverItem,onRemoveItem:n.removeItem},null,8,["width","height","width_","height_","shape","left","margin","selected","objects","onSetObjects","onHoverItem","onRemoveItem"])):W("",!0)],4),s("section",{class:"navigator",style:r({marginTop:`${e.top-48}px`,marginLeft:`${e.right}px`})},[s("span",{class:"next",style:r({backgroundColor:e.color}),onClick:h[1]||(h[1]=(...a)=>n.next&&n.next(...a))},g("❯"),4)],4)])])}const z=y(O,[["render",E]]);export{z as default};
