import{c as S,$ as u,f as r,u as l,m as v,I as C,a as T,B as y,D as B,_ as W,b as f,d as a,w as d,n as L,g as z,r as m,o as g,h as p,i as N,F as A,k as D,e as O,q as V,j as I}from"./index-eba71058.js";import F from"./List-0646a804.js";import P from"./Aside-c2f94b25.js";import E from"./Chart-d04bcb05.js";import J from"./Slider-e51ee24d.js";import R from"./Switch-2a98c72b.js";const q={data(){return{id_:"",out:"",batch:1,data:"",epoch:1,task:"",tasks:[],width:1,data_:[],error:"",height:1,title:"",config:"",device:"",margin:16,params:[],timers:[],titles:[],configs:[],devices:[],padding:16,results:{},xLabels:[],color:S,sessions:[],asideWidth:0,asideWidth_:0,interval:null}},mounted(){this.load(),this.asideWidth_=u(window).width()<1480?280:320,r(`${l}/devices`,{}).then(t=>{this.devices=t.devices}).catch(t=>this.error=t)},updated(){this.width=u(window).width()-(this.asideWidth||this.asideWidth_)-this.margin*2-this.padding*2,this.height=u(window).height()-u(".nav").height()-this.margin*2-this.padding*2},computed:{items(){return this.sessions.map(t=>({text:t.id_,status:t.status}))}},watch:{task(){r(`${l}/configs`,{task:this.task}).then(t=>{this.configs=t.configs,this.config=this.configs[0]}).catch(t=>this.error=t),this.save()},title(){this.setChart()},config(){let t={id_:this.id_,action:"param",task:this.task,pipeline:"train",cfg_id:this.config};r(`${l}/main`,t).then(i=>{this.params=i.params.map(e=>({min:e.min_,max:e.max_,value:e.value,name:e.name.replace("_"," "),type:e.type.replace("bool","switch").replace("range","slider")}))}).catch(i=>this.error=i),this.save()},results(){this.setChart()}},methods:{load(){r(`${l}/load`,{file:"ai.json"}).then(t=>{this.id_=t.id_||"",this.task=t.task||"",this.out=t.out_dir||"",this.epoch=t.epochs||"",this.data=t.data_dir||"",this.config=t.cfg_id||"",this.device=t.device||"",this.batch=t.batch_size||"",this.sessions=JSON.parse(t.sessions)||[],this.sessions.length&&this.setTimer(this.id_)}).catch(t=>this.error=t)},save(t,i){i&&t&&(this[i.split(" ")[0].toLowerCase()]=t);let e={file:"ai.json",action:"train",id_:this.id_||"",task:this.task||"",out_dir:this.out||"",epochs:this.epoch||"",data_dir:this.data||"",cfg_id:this.config||"",device:this.device||"",batch_size:this.batch||"",sessions:JSON.stringify(this.sessions||[])};for(const h of this.params)e[h.name]=h.value;r(`${l}/save`,e).catch(h=>this.error=h)},fetch(){if(this.id_==""||this.out==""||this.config==""||this.data=="")return;let t={id_:this.id_,action:"result",out_dir:this.out,cfg_id:this.config,data_dir:this.data};r(`${l}/main`,t).then(i=>{this.results=i.results,this.titles=Object.keys(this.results||{}),this.titles.length&&(this.results[this.titles[0]].length.toString()==this.epoch?(this.sessions.find(e=>e.id_==this.id_).status="Stopped",this.clearTimer(this.id_)):this.sessions.find(e=>e.id_==this.id_).status="Training")}).catch(i=>this.error=i)},slide(t,i){let e=this.params.findIndex(h=>h.name==i);this.params[e].value=parseFloat(t)},train(t){this.id_="",this.title="";let i={id_:`session${this.sessions.length?parseInt(this.sessions.at(-1).id_.replace("session",""))+1:0}`,action:"train",status:"Starting",task:this.task,out_dir:this.out,epochs:this.epoch,cfg_id:this.config,data_dir:this.data,batch_size:this.batch,device:this.device.replace(/GPU:/g,"")};for(const e of this.params)i[e.name]=e.value;return r(`${l}/main`,i).catch(e=>this.error=e),this.sessions.push(i),this.id_=i.id_,this.save(),this.setTimer(this.id_),t},swtich_(t,i){let e=this.params.findIndex(h=>h.name==i);this.params[e].value=!!t,this.save()},setChart(){if(!this.title)return;this.data_=this.results[this.title],this.data_.unshift(0);let t=10,i=(Math.ceil(this.data_.length/t)+(this.data_.length<this.epoch,0))*t;this.xLabels=this.data_.length?v(i,t):v(t+1)},setTimer(t){let i=this.timers.findIndex(e=>e.id==t);i>-1?this.timers[i].interval=setInterval(()=>this.fetch(),1e3):this.timers.push({id:t,interval:setInterval(()=>this.fetch(),1e3)})},clearTimer(t){let i=this.timers.findIndex(e=>e.id==t);i>-1&&clearInterval(this.timers[i].interval),this.timers=this.timers.filter(e=>e.id==t)},clickItem(t){let i=this.sessions.find(e=>e.id_==t);this.id_=t,this.task=i.task,this.out=i.out_dir,this.epoch=i.epochs,this.data=i.data_dir,this.config=i.cfg_id,this.device=i.device,this.batch=i.batch_size},removeItem(t){let i={id_:t,action:"remove",out_dir:this.out,cfg_id:this.config,data_dir:this.data};this.sessions=this.sessions.filter(e=>e.id_!=t),this.clearTimer(this.id_),this.id_="",this.save(),r(`${l}/main`,i).catch(e=>this.error=e)},toggleItem(t){let i={id_:t,action:"toggle",out_dir:this.out,cfg_id:this.config,data_dir:this.data};r(`${l}/main`,i).catch(e=>this.error=e)}},components:{Icon:C,List:F,Aside:P,Chart:E,Input:T,Button:y,Slider:J,Switch:R,Dropdown:B}};const G={class:"train"},M=I("section",null,null,-1),U={class:"toolbar",style:{width:"30%"}};function H(t,i,e,h,s,n){const _=m("Input"),c=m("dropdown"),b=m("Button"),w=m("list"),k=m("Aside"),x=m("chart");return g(),f("section",G,[a(k,{class:"train",margin:0,width:s.asideWidth_,onSetWidth:i[0]||(i[0]=o=>s.asideWidth=o)},{default:d(()=>[a(c,{class:p("accordion"),accordion:"Basic"},{default:d(()=>[a(_,{label:"Data Path",value:s.data,onInput:n.save,icon:"folder",height:24,box:32,right:!0},null,8,["value","onInput"]),a(_,{label:"Out Path",value:s.out,onInput:n.save,icon:"folder",height:24,box:32,right:!0},null,8,["value","onInput"]),a(c,{label:"Task",value:s.task,onSelect:n.save,items:["classification","detection","segmentation"]},null,8,["value","onSelect"]),a(c,{label:"Config",value:s.config,onSelect:n.save,items:s.configs},null,8,["value","onSelect","items"]),a(c,{label:"Device",value:s.device,onSelect:n.save,items:s.devices},null,8,["value","onSelect","items"]),a(_,{label:"Batch",value:s.batch,onInput:n.save},null,8,["value","onInput"]),a(_,{label:"Epoch",value:s.epoch,onInput:n.save},null,8,["value","onInput"])]),_:1}),a(c,{class:p("accordion"),accordion:"Sessions"},{default:d(()=>[a(b,{onClick:n.train},{default:d(()=>[N("Train")]),_:1},8,["onClick"]),a(w,{items:n.items,onRemoveItem:n.removeItem,onToggleItem:n.toggleItem,onClickItem:n.clickItem},null,8,["items","onRemoveItem","onToggleItem","onClickItem"])]),_:1}),a(c,{class:p("accordion"),accordion:"Advanced"},{default:d(()=>[M,(g(!0),f(A,null,D(s.params,o=>(g(),O(V(o.type),{class:"param",float:"right",padding:8,label_:o.name,range:"80%",min:o.min,max:o.max,onSlide:n.slide,_on:o.name,onSwitch:n.swtich_},null,40,["label_","min","max","onSlide","_on","onSwitch"]))),256))]),_:1})]),_:1},8,["width"]),s.data_.length?(g(),f("section",{key:0,class:"charts",style:L({marginLeft:`${s.asideWidth||s.asideWidth_}px`})},[a(x,{data:s.data_,width:s.width,height:s.height-32,margin:s.margin,padding:s.padding,"x-labels":s.xLabels},{default:d(()=>[I("section",U,[a(c,{onSelect:i[1]||(i[1]=o=>s.title=o),items:s.titles,selected:s.title,width:"100%"},null,8,["items","selected"])])]),_:1},8,["data","width","height","margin","padding","x-labels"])],4)):z("",!0)])}const $=W(q,[["render",H]]);export{$ as default};
