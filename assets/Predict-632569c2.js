import{c as x,$ as m,f as n,m as v,u as r,I as S,a as C,B as T,D as B,_ as W,b as w,d as a,w as l,r as _,o as g,h as f,i as I,F as P,k as y,e as z,q as A,j as D}from"./index-eba71058.js";import L from"./List-0646a804.js";import N from"./Aside-c2f94b25.js";import O from"./Chart-d04bcb05.js";import F from"./Slider-e51ee24d.js";import V from"./Switch-2a98c72b.js";const E={data(){return{id_:"",out:"",batch:1,data:"",task:"",width:1,data_:[],error:"",tasks:[],height:1,title:"",config:"",device:"",margin:16,params:[],timers:[],titles:[],configs:[],devices:[],padding:16,results:{},weights:"",xLabels:[],color:x,sessions:[],asideWidth:0,asideWidth_:0,interval:null}},mounted(){this.load(),this.asideWidth_=m(window).width()<1480?280:320,n(`${r}/tasks`,{}).then(t=>{this.tasks=t.tasks}).catch(t=>this.error=t),n(`${r}/devices`,{}).then(t=>{this.devices=t.devices}).catch(t=>this.error=t)},updated(){this.width=m(window).width()-(this.asideWidth||this.asideWidth_)-this.margin*2-this.padding*2,this.height=m(window).height()-m(".nav").height()-this.margin*2-this.padding*2},computed:{items(){return this.sessions.map(t=>({text:t.id_,status:t.status}))}},methods:{load(){n(`${r}/load`,{file:"ai.json"}).then(t=>{this.task=t.task||"",this.out=t.out_dir||"",this.data=t.data_dir||"",this.config=t.cfg_id||"",this.device=t.device||"",this.weights=t.weights||"",this.batch=t.batch_size||"",this.sessions=JSON.parse(t.sessions)||[]}).catch(t=>this.error=t),this.setTimer(this.id_)},save(t,i){i&&t&&(this[i.split(" ")[0].toLowerCase()]=t);let s={file:"ai.json",action:"predict",id_:this.id_||"",task:this.task||"",out_dir:this.out||"",data_dir:this.data||"",cfg_id:this.config||"",device:this.device||"",weights:this.weights||"",batch_size:this.batch||"",sessions:JSON.stringify(this.sessions||[])};for(const o of this.params)s[o.name]=o.value;n(`${r}/save`,s).catch(o=>this.error=o)},fetch(){if(this.id_==""||this.out==""||this.config==""||this.data=="")return;let t={id_:this.id_,action:"result",out_dir:this.out,cfg_id:this.config,data_dir:this.data};n(`${r}/main`,t).then(i=>{this.results=i.results,this.titles=Object.keys(this.results||{}),this.titles.length&&(this.results[this.titles[0]].length.toString()==this.epoch?(this.sessions.find(s=>s.id_==this.id_).status="Stopped",this.clearTimer(this.id_)):this.sessions.find(s=>s.id_==this.id_).status="Predicting")}).catch(i=>this.error=i)},slide(t,i){let s=this.params.findIndex(o=>o.name==i);this.params[s].value=parseFloat(t)},export_(t){this.id_="",this.title="";let i={id_:`session${this.sessions.length?parseInt(this.sessions.at(-1).id_.replace("session",""))+1:0}`,action:"export",status:"Starting",task:this.task,out_dir:this.out,cfg_id:this.config,data_dir:this.data,weights:this.weights,batch_size:this.batch,device:this.device.replace(/GPU:/g,"")};for(const s of this.params)i[s.name]=s.value;return n(`${r}/main`,i).catch(s=>this.error=s),this.sessions.push(i),this.id_=i.id_,this.save(),this.setTimer(this.id_),t},predict(t){this.id_="",this.title="";let i={id_:`session${this.sessions.length?parseInt(this.sessions.at(-1).id_.replace("session",""))+1:0}`,action:"predict",status:"Starting",out_dir:this.out,cfg_id:this.config,data_dir:this.data,weights:this.weights,batch_size:this.batch,device:this.device.replace(/GPU:/g,"")};for(const s of this.params)i[s.name]=s.value;return n(`${r}/main`,i).catch(s=>this.error=s),this.sessions.push(i),this.id_=i.id_,this.save(),this.setTimer(this.id_),t},swtich_(t,i){let s=this.params.findIndex(o=>o.name==i);this.params[s].value=!!t,this.save()},setChart(){if(!this.title)return;this.data_=this.results[this.title],this.data_.unshift(0);let t=10,i=(Math.ceil(this.data_.length/t)+(this.data_.length<this.epoch,0))*t;this.xLabels=this.data_.length?v(i,t):v(t+1)},setTimer(t){let i=this.timers.findIndex(s=>s.id==t);i>-1?this.timers[i].interval=setInterval(()=>this.fetch(),1e3):this.timers.push({id:t,interval:setInterval(()=>this.fetch(),1e3)})},clickItem(t){let i=this.sessions.find(s=>s.id_==t);this.id_=t,this.task=i.task,this.out=i.out_dir,this.epoch=i.epochs,this.data=i.data_dir,this.config=i.cfg_id,this.device=i.device,this.weights=i.weights,this.batch=i.batch_size},clearTimer(t){let i=this.timers.findIndex(s=>s.id==t);i>-1&&clearInterval(this.timers[i].interval),this.timers=this.timers.filter(s=>s.id==t)},removeItem(t){let i={id_:t,action:"remove",out_dir:this.out,cfg_id:this.config,data_dir:this.data};this.sessions=this.sessions.filter(s=>s.id_!=t),this.clearTimer(this.id_),this.id_="",this.save(),n(`${r}/main`,i).catch(s=>this.error=s)},toggleItem(t){let i={id_:t,action:"toggle",out_dir:this.out,cfg_id:this.config,data_dir:this.data};n(`${r}/main`,i).catch(s=>this.error=s)}},watch:{task(){n(`${r}/configs`,{task:this.task}).then(t=>{this.configs=t.configs,this.config=this.configs[0]}).catch(t=>this.error=t),this.save()},config(){let t={id_:this.id_,action:"param",task:this.task,process:"predict",cfg_id:this.config};n(`${r}/main`,t).then(i=>{this.params=i.params.map(s=>({min:s.min_,max:s.max_,value:s.value,name:s.name.replace("_"," "),type:s.type.replace("bool","switch").replace("range","slider")}))}).catch(i=>this.error=i),this.save()},title(){this.setChart()},results(){this.setChart()}},components:{Icon:S,List:L,Aside:N,Chart:O,Input:C,Button:T,Slider:F,Switch:V,Dropdown:B}};const G={class:"predict"},J=D("section",null,null,-1);function R(t,i,s,o,h,e){const u=_("Input"),c=_("dropdown"),p=_("Button"),k=_("list"),b=_("Aside");return g(),w("section",G,[a(b,{class:"predict",margin:0,width:h.asideWidth_,onSetWidth:i[0]||(i[0]=d=>h.asideWidth=d)},{default:l(()=>[a(c,{class:f("accordion"),accordion:"Basic"},{default:l(()=>[a(u,{label:"Data Path",value:h.data,onInput:e.save,icon:"folder",height:24,box:32,right:!0},null,8,["value","onInput"]),a(u,{label:"Out Path",value:h.out,onInput:e.save,icon:"folder",height:24,box:32,right:!0},null,8,["value","onInput"]),a(c,{label:"Task",value:h.task,onSelect:e.save,items:h.tasks},null,8,["value","onSelect","items"]),a(c,{label:"Config",value:h.config,onSelect:e.save,items:h.configs},null,8,["value","onSelect","items"]),a(c,{label:"Device",value:h.device,onSelect:e.save,items:h.devices},null,8,["value","onSelect","items"]),a(u,{label:"Batch",value:h.batch,onInput:e.save},null,8,["value","onInput"]),a(u,{label:"Weights",value:h.weights,onInput:e.save,icon:"folder",height:24,box:32,right:!0},null,8,["value","onInput"])]),_:1}),a(c,{class:f("accordion"),accordion:"Sessions"},{default:l(()=>[a(p,{onClick:e.predict},{default:l(()=>[I("Predict")]),_:1},8,["onClick"]),a(p,{onClick:e.export_},{default:l(()=>[I("Export")]),_:1},8,["onClick"]),a(k,{items:e.items,onRemoveItem:e.removeItem,onToggleItem:e.toggleItem,onClickItem:e.clickItem},null,8,["items","onRemoveItem","onToggleItem","onClickItem"])]),_:1}),a(c,{class:f("accordion"),accordion:"Advanced"},{default:l(()=>[J,(g(!0),w(P,null,y(h.params,d=>(g(),z(A(d.type),{class:"param",float:"right",padding:8,label_:d.name,range:"80%",min:d.min,max:d.max,onSlide:e.slide,_on:d.name,onSwitch:e.swtich_},null,40,["label_","min","max","onSlide","_on","onSwitch"]))),256))]),_:1})]),_:1},8,["width"])])}const X=W(E,[["render",R]]);export{X as default};
